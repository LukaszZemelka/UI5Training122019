/*
 * ! OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/write/connectors/BaseConnector","sap/ui/fl/apply/_internal/connectors/BrowserStorageUtils"],function(m,B,a){"use strict";function s(p,c){var d=true;if(p.selectorIds){if(c.selector){d=p.selectorIds.indexOf(c.selector.id)>-1;}else{d=false;}}if(d&&p.changeTypes){d=p.changeTypes.indexOf(c.changeType)>-1;}return d;}var b=m({},B,{oStorage:undefined,layers:["ALL"],write:function(p){var P=p.flexObjects.map(function(f){var k=a.createFlexObjectKey(f);var F=this.oStorage._itemsStoredAsObjects?f:JSON.stringify(f);var S=this.oStorage.setItem(k,F);return Promise.resolve(S);}.bind(this));return Promise.all(P).then(function(){});},update:function(p){var f=p.flexObject;var k=a.createFlexObjectKey(p.flexObject);var F=this.oStorage._itemsStoredAsObjects?f:JSON.stringify(f);var S=this.oStorage.setItem(k,F);return Promise.resolve(S);},reset:function(p){return a.forEachObjectInStorage({storage:this.oStorage,reference:p.reference,layer:p.layer},function(f){if(s(p,f.changeDefinition)){return this.oStorage.removeItem(f.key);}}.bind(this));},remove:function(p){var k=a.createFlexObjectKey(p.flexObject);this.oStorage.removeItem(k);var r=this.oStorage.removeItem(k);return Promise.resolve(r);},loadFeatures:function(){return Promise.resolve({});},getFlexInfo:function(p){p.storage=this.oStorage;return a.getAllFlexObjects(p).then(function(f){return{isResetEnabled:f.length>0};});}});return b;},true);
